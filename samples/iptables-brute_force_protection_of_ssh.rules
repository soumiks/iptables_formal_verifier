# 1. Set/Track
-A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m recent --set --name SSH_LIMIT

# 2. Log if limit exceeded (Check ONLY, do not update timestamp to avoid double counting)
-A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m recent --rcheck --seconds 60 --hitcount 4 --name SSH_LIMIT -j LOG --log-prefix "SSH Brute Force: "

# 3. Drop if limit exceeded
-A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m recent --update --seconds 60 --hitcount 4 --name SSH_LIMIT -j DROP

# 4. Accept legitimate traffic
-A INPUT -p tcp --dport 22 -j ACCEPT